<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MANNA</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        function MannaTracker() {
            const [allData, setAllData] = useState({});
            const [currentDate, setCurrentDate] = useState('');
            const [currentText, setCurrentText] = useState('');

            const [copied, setCopied] = useState(false);
            const [viewMonth, setViewMonth] = useState(new Date().toISOString().substring(0, 7));

            const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];

            const getDayOfWeek = (dateStr) => {
                if (!dateStr) return '';
                const date = new Date(dateStr);
                return dayNames[date.getDay()];
            };

            const isWeekday = (dateStr) => {
                return true; // Î™®Îì† ÏöîÏùº ÌóàÏö©
            };

            const getWeekNumber = (dateStr) => {
                const date = new Date(dateStr);
                const firstDay = new Date(date.getFullYear(), 0, 1);
                const pastDays = (date - firstDay) / 86400000;
                return Math.ceil((pastDays + firstDay.getDay() + 1) / 7);
            };

            const getMonthWeekdays = (yearMonth) => {
                const [year, month] = yearMonth.split('-').map(Number);
                const firstDay = new Date(year, month - 1, 1);
                const lastDay = new Date(year, month, 0);
                const allDays = [];

                for (let d = new Date(firstDay); d <= lastDay; d.setDate(d.getDate() + 1)) {
                    const day = d.getDay();
                    const dateStr = d.toISOString().split('T')[0];
                    allDays.push({
                        date: dateStr,
                        day: d.getDate(),
                        dayName: dayNames[day],
                        hasData: !!allData[dateStr]
                    });
                }

                return allDays;
            };

            const loadDate = (dateStr) => {
                if (!dateStr) {
                    setCurrentText('');
                    setCurrentMemo('');
                    return;
                }

                if (allData[dateStr]) {
                    setCurrentText(allData[dateStr].text || '');
                    setCurrentMemo(allData[dateStr].memo || '');
                } else {
                    setCurrentText('');
                    setCurrentMemo('');
                }
            };

            const saveCurrentDate = () => {
                if (currentDate && (currentText || currentMemo)) {
                    setAllData(prev => ({
                        ...prev,
                        [currentDate]: {
                            text: currentText,
                            memo: currentMemo,
                            dayOfWeek: getDayOfWeek(currentDate),
                            weekNumber: getWeekNumber(currentDate)
                        }
                    }));
                }
            };

            const handleDateChange = (newDate) => {
                saveCurrentDate();
                setCurrentDate(newDate);
                setViewMonth(newDate.substring(0, 7));
                loadDate(newDate);
            };

            const handleTextChange = (value) => {
                setCurrentText(value);
            };

            const exportAllData = () => {
                saveCurrentDate();
                const data = {
                    allData: allData,
                    exportDate: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `MANNA_Ï†ÑÏ≤¥Îç∞Ïù¥ÌÑ∞.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const exportCombinedText = () => {
                saveCurrentDate();
                let combinedText = `MANNA Ï†ÑÏ≤¥ ÎÖπÏ∑®\n\n`;
                
                const sortedDates = Object.keys(allData).sort();
                let currentYear = null;
                let currentWeek = null;

                sortedDates.forEach(date => {
                    const entry = allData[date];
                    const [year, month, day] = date.split('-');
                    const weekNum = entry.weekNumber;
                    
                    if (currentYear !== year) {
                        currentYear = year;
                        combinedText += `\n${'='.repeat(60)}\n`;
                        combinedText += `${year}ÎÖÑ\n`;
                        combinedText += `${'='.repeat(60)}\n\n`;
                    }
                    
                    if (currentWeek !== weekNum) {
                        currentWeek = weekNum;
                        combinedText += `\n[ ${weekNum}Ï£ºÏ∞® ]\n\n`;
                    }
                    
                    if (entry.text) {
                        combinedText += `„Äê${entry.dayOfWeek}ÏöîÏùº ${month}/${day}„Äë\n`;
                        combinedText += `${entry.text}\n\n`;
                    }
                });

                const blob = new Blob([combinedText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `MANNA_Ï†ÑÏ≤¥ÎÖπÏ∑®.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            setAllData(data.allData || {});
                            if (currentDate && data.allData[currentDate]) {
                                loadDate(currentDate);
                            }
                        } catch (error) {
                            alert('ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            const copyToClipboard = async () => {
                saveCurrentDate();
                const data = {
                    allData: allData,
                    exportDate: new Date().toISOString()
                };
                try {
                    await navigator.clipboard.writeText(JSON.stringify(data, null, 2));
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    alert('ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
            };

            const goToToday = () => {
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                handleDateChange(todayStr);
            };

            const changeDay = (offset) => {
                if (!currentDate) {
                    goToToday();
                    return;
                }
                const date = new Date(currentDate);
                date.setDate(date.getDate() + offset);
                const newDate = date.toISOString().split('T')[0];
                handleDateChange(newDate);
            };

            const changeMonth = (offset) => {
                const [year, month] = viewMonth.split('-').map(Number);
                const newDate = new Date(year, month - 1 + offset, 1);
                const newYear = newDate.getFullYear();
                const newMonth = newDate.getMonth() + 1;
                setViewMonth(`${newYear}-${String(newMonth).padStart(2, '0')}`);
            };

            const totalEntries = Object.keys(allData).length;

            const monthWeekdays = getMonthWeekdays(viewMonth);
            const monthStats = {
                written: monthWeekdays.filter(d => !d.isEmpty && d.hasData).length
            };

            const dayOfWeek = getDayOfWeek(currentDate);
            const isValidDay = isWeekday(currentDate);
            const weekNum = currentDate ? getWeekNumber(currentDate) : null;

            return (
                <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            {/* Left Column - Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Header */}
                                <div className="bg-white rounded-lg shadow-lg p-6">
                                    <div className="flex items-center justify-between mb-4 flex-wrap gap-4">
                                        <div className="flex items-center gap-3">
                                            <div className="text-4xl">üçû</div>
                                            <div>
                                                <h1 className="text-3xl font-bold text-amber-800">MANNA</h1>
                                                <p className="text-sm text-gray-600">
                                                    Ï¥ù {totalEntries}Ïùº Í∏∞Î°ù
                                                </p>
                                            </div>
                                        </div>
                                        <div className="flex gap-2 flex-wrap">
                                            <button
                                                onClick={copyToClipboard}
                                                title="ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨"
                                                className="flex items-center gap-2 px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm"
                                            >
                                                {copied ? '‚úì' : 'üìã'}
                                            </button>
                                            <button
                                                onClick={exportAllData}
                                                title="Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÌååÏùºÎ°ú Ï†ÄÏû•"
                                                className="flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm"
                                            >
                                                üíæ
                                            </button>
                                            <button
                                                onClick={exportCombinedText}
                                                title="ÌÖçÏä§Ìä∏ ÌååÏùºÎ°ú Ìï©ÏπòÍ∏∞"
                                                className="flex items-center gap-2 px-3 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors text-sm"
                                            >
                                                üìÑ
                                            </button>
                                            <label title="Ï†ÄÏû•Îêú ÌååÏùº Î∂àÎü¨Ïò§Í∏∞" className="flex items-center gap-2 px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors cursor-pointer text-sm">
                                                üìÇ
                                                <input type="file" accept=".json" onChange={importData} className="hidden" />
                                            </label>
                                        </div>
                                    </div>

                                    {/* Date Input */}
                                    <div className="flex gap-3 items-center mb-4">
                                        <button
                                            onClick={() => changeDay(-1)}
                                            className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 font-bold"
                                        >
                                            ‚óÄ
                                        </button>
                                        <input
                                            type="date"
                                            value={currentDate}
                                            onChange={(e) => handleDateChange(e.target.value)}
                                            className="flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-amber-500 focus:outline-none text-lg font-semibold"
                                        />
                                        <button
                                            onClick={goToToday}
                                            className="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600"
                                        >
                                            Ïò§Îäò
                                        </button>
                                        <button
                                            onClick={() => changeDay(1)}
                                            className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 font-bold"
                                        >
                                            ‚ñ∂
                                        </button>
                                    </div>

                                    {currentDate && (
                                        <div className="text-center mb-2">
                                            <span className="text-2xl font-bold text-gray-800">
                                                {dayOfWeek}ÏöîÏùº
                                            </span>
                                            {weekNum && (
                                                <span className="text-gray-500 ml-3">
                                                    ({weekNum}Ï£ºÏ∞®)
                                                </span>
                                            )}
                                        </div>
                                    )}
                                </div>

                                {/* Main Input */}
                                {currentDate && isValidDay && (
                                    <div className="bg-white rounded-lg shadow-md p-5">
                                        <div className="mb-3">
                                            <h3 className="text-xl font-semibold text-gray-800">
                                                {currentDate} ({dayOfWeek}ÏöîÏùº)
                                            </h3>
                                        </div>
                                        <textarea
                                            value={currentText}
                                            onChange={(e) => handleTextChange(e.target.value)}
                                            placeholder="Ïò§ÎäòÏùò ÎÖπÏ∑® ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-amber-500 focus:outline-none resize-none"
                                            rows={10}
                                            onBlur={saveCurrentDate}
                                        />
                                        {currentText && (
                                            <div className="mt-2 text-sm text-gray-600">
                                                {currentText.length}Ïûê
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Right Column - Calendar View */}
                            <div className="space-y-6">
                                {/* Monthly Calendar */}
                                <div className="bg-white rounded-lg shadow-lg p-5">
                                    <div className="flex items-center justify-between mb-4">
                                        <button
                                            onClick={() => changeMonth(-1)}
                                            className="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300"
                                        >
                                            ‚óÄ
                                        </button>
                                        <h3 className="text-lg font-bold text-gray-800">
                                            {viewMonth.replace('-', 'ÎÖÑ ')}Ïõî
                                        </h3>
                                        <button
                                            onClick={() => changeMonth(1)}
                                            className="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300"
                                        >
                                            ‚ñ∂
                                        </button>
                                    </div>

                                    <div className="mb-4 p-3 bg-amber-50 rounded-lg text-center">
                                        <div className="text-lg">
                                            <span className="text-green-600 font-bold text-2xl">{monthStats.written}</span>
                                            <span className="text-gray-600 ml-2">Ïùº ÏûëÏÑ±</span>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-7 gap-1 mb-2">
                                        <div className="text-center text-xs font-semibold text-red-500 py-1">Ïùº</div>
                                        <div className="text-center text-xs font-semibold text-gray-600 py-1">Ïõî</div>
                                        <div className="text-center text-xs font-semibold text-gray-600 py-1">Ìôî</div>
                                        <div className="text-center text-xs font-semibold text-gray-600 py-1">Ïàò</div>
                                        <div className="text-center text-xs font-semibold text-gray-600 py-1">Î™©</div>
                                        <div className="text-center text-xs font-semibold text-gray-600 py-1">Í∏à</div>
                                        <div className="text-center text-xs font-semibold text-blue-600 py-1">ÌÜ†</div>
                                    </div>

                                    <div className="grid grid-cols-7 gap-1">
                                        {monthWeekdays.map((item, index) => 
                                            item.isEmpty ? (
                                                <div key={`empty-${index}`} className="p-2"></div>
                                            ) : (
                                                <button
                                                    key={item.date}
                                                    onClick={() => handleDateChange(item.date)}
                                                    className={`p-2 rounded-lg text-center transition-all ${
                                                        item.date === currentDate
                                                            ? 'bg-amber-500 text-white font-bold ring-2 ring-amber-600'
                                                            : item.hasData
                                                            ? 'bg-green-100 text-green-700 hover:bg-green-200'
                                                            : 'bg-red-50 text-red-500 hover:bg-red-100'
                                                    }`}
                                                >
                                                    <div className="font-bold">{item.day}</div>
                                                </button>
                                            )
                                        )}
                                    </div>

                                    <div className="mt-4 text-xs space-y-1">
                                        <div className="flex items-center gap-2">
                                            <div className="w-4 h-4 bg-green-100 rounded"></div>
                                            <span>ÏûëÏÑ± ÏôÑÎ£å</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <div className="w-4 h-4 bg-red-50 rounded"></div>
                                            <span>ÎØ∏ÏûëÏÑ±</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Tips */}
                                <div className="bg-white rounded-lg shadow-md p-5">
                                    <h3 className="font-semibold text-gray-800 mb-3">üìù Í∞ÑÎã® Î©îÎ™®</h3>
                                    {currentDate ? (
                                        <div>
                                            <div className="text-sm text-gray-600 mb-2">
                                                {currentDate} ({dayOfWeek}ÏöîÏùº)
                                            </div>
                                            <textarea
                                                value={currentMemo}
                                                onChange={(e) => setCurrentMemo(e.target.value)}
                                                onBlur={saveCurrentDate}
                                                placeholder="Ïò§ÎäòÏùò Í∞ÑÎã®Ìïú Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
                                                className="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-amber-500 focus:outline-none resize-none text-sm"
                                                rows={4}
                                            />
                                            {currentMemo && (
                                                <div className="mt-1 text-xs text-gray-500">
                                                    {currentMemo.length}Ïûê
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div className="text-sm text-gray-500 text-center py-4">
                                            ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÎ©¥ Î©îÎ™®Î•º ÏûëÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MannaTracker />);
    </script>
</body>
</html>
